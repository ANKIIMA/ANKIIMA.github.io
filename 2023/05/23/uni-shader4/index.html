<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ankiima.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前面我们学习了基础纹理和法线纹理，现在我们认识到纹理就是顶点的某种数据，我们下面将学习渐变纹理和遮罩纹理。之后我们再补充一些透明的基本做法，那么入门精要的基础篇就完成了。">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity和Shader入门（四）">
<meta property="og:url" content="https://ankiima.github.io/2023/05/23/uni-shader4/index.html">
<meta property="og:site_name" content="ANKIIMA">
<meta property="og:description" content="前面我们学习了基础纹理和法线纹理，现在我们认识到纹理就是顶点的某种数据，我们下面将学习渐变纹理和遮罩纹理。之后我们再补充一些透明的基本做法，那么入门精要的基础篇就完成了。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/3.jpg">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/1.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/2.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/3.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/4.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/8.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/9.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/10.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/5.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/6.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/7.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/11.png">
<meta property="og:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/12.png">
<meta property="article:published_time" content="2023-05-23T13:27:22.000Z">
<meta property="article:modified_time" content="2024-10-05T08:48:41.469Z">
<meta property="article:author" content="ANKIIMA">
<meta property="article:tag" content="CG">
<meta property="article:tag" content="Unity">
<meta property="article:tag" content="Shader">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ankiima.github.io/2023/05/23/uni-shader4/3.jpg">


<link rel="canonical" href="https://ankiima.github.io/2023/05/23/uni-shader4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ankiima.github.io/2023/05/23/uni-shader4/","path":"2023/05/23/uni-shader4/","title":"Unity和Shader入门（四）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Unity和Shader入门（四） | ANKIIMA</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ANKIIMA</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%90%E5%8F%98%E7%BA%B9%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">渐变纹理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%81%AE%E7%BD%A9%E7%BA%B9%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">遮罩纹理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C"><span class="nav-number">3.</span> <span class="nav-text">透明效果</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B5%8B%E8%AF%95"><span class="nav-number">3.1.</span> <span class="nav-text">透明度测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B7%B7%E5%90%88"><span class="nav-number">3.2.</span> <span class="nav-text">透明度混合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%B7%B1%E5%BA%A6%E5%86%99%E5%85%A5%E7%9A%84%E5%8D%8A%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C"><span class="nav-number">3.3.</span> <span class="nav-text">开启深度写入的半透明效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8C%E9%9D%A2%E6%B8%B2%E6%9F%93%E7%9A%84%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C"><span class="nav-number">3.4.</span> <span class="nav-text">双面渲染的透明效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%8F%8C%E9%9D%A2%E6%B8%B2%E6%9F%93%E6%95%88%E6%9E%9C"><span class="nav-number">3.4.1.</span> <span class="nav-text">透明度测试的双面渲染效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%B7%B7%E5%90%88%E7%9A%84%E5%8F%8C%E9%9D%A2%E6%B8%B2%E6%9F%93%E6%95%88%E6%9E%9C"><span class="nav-number">3.4.2.</span> <span class="nav-text">透明度混合的双面渲染效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%8F%E6%98%8E%E6%80%BB%E7%BB%93"><span class="nav-number">3.5.</span> <span class="nav-text">透明总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ANKIIMA"
      src="/images/apple-touch-icon.png">
  <p class="site-author-name" itemprop="name">ANKIIMA</p>
  <div class="site-description" itemprop="description">记录生活的博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ANKIIMA" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ANKIIMA" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:anki1667791793@gmail.com" title="E-Mail → mailto:anki1667791793@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ankiima.github.io/2023/05/23/uni-shader4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/apple-touch-icon.png">
      <meta itemprop="name" content="ANKIIMA">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ANKIIMA">
      <meta itemprop="description" content="记录生活的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Unity和Shader入门（四） | ANKIIMA">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Unity和Shader入门（四）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-23 21:27:22" itemprop="dateCreated datePublished" datetime="2023-05-23T21:27:22+08:00">2023-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphics/" itemprop="url" rel="index"><span itemprop="name">Computer Graphics</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Graphics/Engine/" itemprop="url" rel="index"><span itemprop="name">Engine</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>前面我们学习了基础纹理和法线纹理，现在我们认识到纹理就是顶点的某种数据，我们下面将学习渐变纹理和遮罩纹理。之后我们再补充一些透明的基本做法，那么入门精要的基础篇就完成了。</p>
<span id="more"></span>
<h1 id="渐变纹理"><a href="#渐变纹理" class="headerlink" title="渐变纹理"></a>渐变纹理</h1><p>渐变纹理是用来控制物体漫反射的，我们本来计算漫反射是采用兰伯特公式计算：</p>
<p><img src="/2023/05/23/uni-shader4/3.jpg" alt="场景"></p>
<p>不过曾经有人提出一种基于冷到暖色调变化进行着色的技术，使物体的轮廓线比直接使用漫反射更加明显，而且具有多种色调的变化，卡通渲染中大多使用这种技术。原理就是修改上面公式中的最后一项$n \cdot l$，我们将用这个值扩展得到的二维向量$(n \cdot l, n \cdot l)$来作为uv坐标，使用特定的渐变纹理进行采样，得到需要的颜色并返回到上面公式中作为最后一项。</p>
<p>因此实现渐变纹理只需要轻微改变漫反射即可。我们使用半兰伯特光照模型的漫反射，看看它的效果如何。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Learn/Ramp Texture&quot;</span><br><span class="line">&#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">		_Color(&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">		_RampTex(&quot;Ramp Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_Specular(&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">		_Gloss(&quot;Gloss&quot;, Range(8.0,256)) = 20</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags &#123; &quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line"></span><br><span class="line">			CGPROGRAM</span><br><span class="line">			#pragma vertex vert</span><br><span class="line">			#pragma fragment frag</span><br><span class="line">			#include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">			fixed4 _Color;</span><br><span class="line">			sampler2D _RampTex;</span><br><span class="line">			float4 _RampTex_ST;</span><br><span class="line">			fixed4 _Specular;</span><br><span class="line">			float _Gloss;</span><br><span class="line"></span><br><span class="line">			struct a2v&#123;</span><br><span class="line">				float4 vertex : POSITION;</span><br><span class="line">				float3 normal : NORMAL;</span><br><span class="line">				float4 texcoord : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			struct v2f&#123;</span><br><span class="line">				float4 pos : SV_POSITION;</span><br><span class="line">				float3 worldNormal : TEXCOORD0;</span><br><span class="line">				float3 worldPos : TEXCOORD1;</span><br><span class="line">				float2 uv : TEXCOORD2;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			v2f vert(a2v v)&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">				o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">				o.uv = TRANSFORM_TEX(v.texcoord, _RampTex);</span><br><span class="line"></span><br><span class="line">				return o;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">				fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">				fixed3 worldPos = normalize(i.worldPos);</span><br><span class="line">				fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(worldPos));</span><br><span class="line"></span><br><span class="line">				fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">				fixed halfLambert = 0.5 * dot(worldNormal, worldLightDir) + 0.5;</span><br><span class="line">				//需要修改的地方</span><br><span class="line">				fixed3 diffuseColor = tex2D(_RampTex, fixed2(halfLambert, halfLambert)).rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">				fixed3 diffuse = _LightColor0.rgb * diffuseColor;</span><br><span class="line"></span><br><span class="line">				fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span><br><span class="line">				fixed3 halfDir = normalize(worldNormal + viewDir);</span><br><span class="line">				fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(max(0,dot(worldNormal, halfDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">				return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FallBack &quot;Specular&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了漫反射外，其它地方完全不用修改，得到下面的结果：</p>
<p><img src="/2023/05/23/uni-shader4/1.png" alt></p>
<p>我们看到了明显的颜色变化，而非之前平滑的颜色过渡了，这就是渐变纹理，书中还提供了其它纹理，可以查看它们的不同效果。</p>
<h1 id="遮罩纹理"><a href="#遮罩纹理" class="headerlink" title="遮罩纹理"></a>遮罩纹理</h1><p>在前面的学习中，我们可能会苦恼于镜面光的位置无法控制，因为物体表面不同部分对光的反射各不相同，使用统一的计算显然无法得到不同的结果。但是使用遮罩纹理就可以实现这一点，遮罩纹理可以保护某些区域，在采样的时候将得到一个矢量，它的RGBA通道可能存储了不同的数据，那么在计算中我们让光照乘以其中某个值，让这个通道原本的光照值被改变，就能完成对模型不同表面的遮罩。</p>
<p>具体实现上，让顶点根据默认的uv坐标，对遮罩纹理进行采样，然后直接和镜面光相乘，就可以了，因为我们这里使用的遮罩纹理很简单，它的每个通道都是相同的值，全部表示镜面光强度。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Learn/MaskTexture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties&#123;</span><br><span class="line">        _Color(&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex(&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _BumpMap(&quot;Normal Map&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">        _BumpScale(&quot;Bump Scale&quot;, Float) = 1.0</span><br><span class="line">        _SpecularMask(&quot;Specular Mask&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _SpecularScale(&quot;Specular Scale&quot;, Float) = 1.0</span><br><span class="line">        _Specular(&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss(&quot;Gloss&quot;, Range(8.0,256)) = 20</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader&#123;</span><br><span class="line">        Pass&#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot; = &quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            float _BumpScale;</span><br><span class="line">            sampler2D _SpecularMask;</span><br><span class="line">            float _SpecularScale;</span><br><span class="line">            float4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line"></span><br><span class="line">            struct a2v&#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 tangent : TANGENT;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f&#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float3 lightDir : TEXCOORD1;</span><br><span class="line">                float3 viewDir : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)&#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">                o.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line"></span><br><span class="line">                TANGENT_SPACE_ROTATION;</span><br><span class="line">                o.lightDir = mul(rotation, ObjSpaceLightDir(v.vertex)).xyz;</span><br><span class="line">                o.viewDir = mul(rotation, ObjSpaceViewDir(v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                fixed3 tangentLightDir = normalize(i.lightDir);</span><br><span class="line">                fixed3 tangentViewDir = normalize(i.viewDir);</span><br><span class="line"></span><br><span class="line">                fixed3 tangentNormal = UnpackNormal(tex2D(_BumpMap, i.uv));</span><br><span class="line">                tangentNormal.xy *= _BumpScale;</span><br><span class="line">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = tex2D(_MainTex, i.uv).rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(tangentNormal, tangentLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(tangentLightDir + tangentViewDir);</span><br><span class="line"></span><br><span class="line">                fixed3 specularMask = tex2D(_SpecularMask, i.uv).r * _SpecularScale;</span><br><span class="line">				//修改镜面光计算</span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(max(0,dot(tangentNormal, halfDir)), _Gloss) * specularMask;</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面的代码中我们使用主纹理的缩放、平移对所有纹理进行了操作，这意味着调整主纹理的属性能影响到其它纹理。下面是这个着色器的结果。</p>
<p><img src="/2023/05/23/uni-shader4/2.png" alt></p>
<p>上面提供的讲解都很简单，以后我们可能会进一步使用它们。</p>
<h1 id="透明效果"><a href="#透明效果" class="headerlink" title="透明效果"></a>透明效果</h1><p>纹理基础结束后，我们进入透明效果的学习，之前的学习中我们只使用了颜色通道的RGB值，Alpha并没有使用，他就是表示透明度的，当这个值为1，像素完全显示；这个值为0，像素不会显示。</p>
<p>我们将学习两种实现透明的方式，透明度测试（无法实现真正的半透明）和透明度混合。</p>
<h2 id="透明度测试"><a href="#透明度测试" class="headerlink" title="透明度测试"></a>透明度测试</h2><p>只要一个片元的透明度不满足条件，那么将直接舍弃这个片元，它不会对颜色缓冲有任何影响。在Unity Shader中我们可以使用clip函数完成这个测试。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;_Object2World&#x27; with &#x27;unity_ObjectToWorld&#x27;</span><br><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Learn/Alpha Test&quot;</span><br><span class="line">&#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">		_Color(&quot;Main Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">		_MainTex(&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_Cutoff(&quot;Alpha Cutoff&quot;, Range(0,1)) = 0.5</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">		Tags&#123;&quot;Queue&quot; = &quot;AlphaTest&quot; &quot;IgnoreProjector&quot; = &quot;True&quot; &quot;RenderType&quot; = &quot;TransparentCutout&quot;&#125;</span><br><span class="line"></span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags &#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		CGPROGRAM</span><br><span class="line"></span><br><span class="line">		#pragma vertex vert</span><br><span class="line">		#pragma fragment frag</span><br><span class="line"></span><br><span class="line">		#include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">		fixed4 _Color;</span><br><span class="line">		sampler2D _MainTex;</span><br><span class="line">		float4 _MainTex_ST;</span><br><span class="line">		fixed _Cutoff;</span><br><span class="line"></span><br><span class="line">		struct a2v&#123;</span><br><span class="line">			float4 vertex : POSITION;</span><br><span class="line">			float3 normal : NORMAL;</span><br><span class="line">			float4 texcoord : TEXCOORD0;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		struct v2f&#123;</span><br><span class="line">			float4 pos : SV_POSITION;</span><br><span class="line">			float3 worldNormal : TEXCOORD0;</span><br><span class="line">			float3 worldPos : TEXCOORD1;</span><br><span class="line">			float2 uv : TEXCOORD2;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		v2f vert(a2v v)</span><br><span class="line">		&#123;</span><br><span class="line">			v2f o;</span><br><span class="line">			o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">			</span><br><span class="line">			o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">			o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">			o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">			return o;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">			fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">			fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">			fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line"></span><br><span class="line">			clip(texColor.a - _Cutoff);</span><br><span class="line"></span><br><span class="line">			fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">			fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">			fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">			return fixed4(ambient + diffuse, 1.0);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		ENDCG</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FallBack &quot;Transparent/Cutout/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在SubShader开头使用了三个标签，第一个表示将该模型的渲染归于AlphaTest渲染队列。在渲染过程中，由于透明物体的存在，我们必须先渲染不透明物体，然后再渲染半透明物体，最终得到正确的渲染效果。不过即使这样做也会有问题，因为不同物体之间可能会有遮挡，这时我们不能直接让两个半透明物体渲染，因为它们的深度关系随着形状而改变，必须进一步分割模型网络才能得到正确结果。</p>
<p>Unity中定义了五个渲染队列，它们的含义如下：</p>
<ul>
<li>Bakcground：在其它队列之前绘制，适合背景上的物体；</li>
<li>Geometry：默认的队列，不透明物体使用该队列；</li>
<li>AlphaTest：使用透明度测试的物体；</li>
<li>Transparent：在Geometry和AlphaTest之后，并且从后往前绘制使用了透明度混合的物体；</li>
<li>Overlay：在最后渲染。</li>
</ul>
<p>所以这里我们使用第一个队列。第二个标签是IgnoreProjector，开启后Shader不会受到投影器干扰；最后一个是RenderType，设置为TransparentCutout表示让Unity将这个Shader归入提前定义的组中，指明这个Shader使用了透明度测试。只需要知道，使用透明度测试的Shader一般都要使用这三个标签。</p>
<p>后面的代码就是之前很熟悉的了，不再讲解。这里注意Clip函数的使用即可。</p>
<p>完成后将这一章对应的纹理贴上去(素材都在<a target="_blank" rel="noopener" href="https://github.com/candycat1992/Unity_Shaders_Book">github</a>上)，这张纹理的alpha通道存储了不同的透明度。调整透明度的阈值，看到立方体的某些面消失了。</p>
<p><img src="/2023/05/23/uni-shader4/3.png" alt></p>
<p>这个效果当然不是真正的透明，我们下面来看看透明度混合的做法。</p>
<h2 id="透明度混合"><a href="#透明度混合" class="headerlink" title="透明度混合"></a>透明度混合</h2><p>开启透明度混合后，透明度将作为混合因子来对颜色进行处理。要注意的是，使用透明度混合必须关闭深度写入，但是却需要使用深度测试，这是因为深度写入将直接剔除那些在透明物体之后的点，同时我们又必须通过深度测试判断物体的前后顺序，所以这里深度测试对于我们来说是只读的，它不会影响深度缓存的内容。</p>
<p>使用Unity的混合命令就可以开启混合，它指定了混合时使用的混合函数。</p>
<p><img src="/2023/05/23/uni-shader4/4.png" alt></p>
<p>这里我们使用第二种函数，它处理RGBA的每一个通道，数学公式如下：</p>
<script type="math/tex; mode=display">DstColor_{new}=SrcFactor*SrcColor+DstFctor*DstColor_{old}</script><p>除了相乘后加法以外，我们还可以使用其它不同的公式，使用BlendOp BlendOperation命令可以指定混合公式：</p>
<p><img src="/2023/05/23/uni-shader4/8.png" alt></p>
<p><img src="/2023/05/23/uni-shader4/9.png" alt></p>
<p>其中还可以进一步设置SrcFactor为源的Alpha值，DstFactor为1减去源的Alpha值。源指的是当前处理的颜色，也就是没有写入颜色缓存的值；目标指的是已经存在颜色缓存中的值，混合就是将当前处理的颜色和存在颜色缓冲的颜色进行混合，得到的新颜色再次覆盖原来颜色缓存中的值。将它转化成数学公式：</p>
<script type="math/tex; mode=display">DstColor_{new}=SrcAlpha*SrcColor+(1-SrcAlpha)*DstColor_{old}</script><p>当然也有其它的指定方式，语法为[Blend SrcFactor DstFactor, SrcFactorA DstFactorA]。其中Factor可以替换为以下的值：</p>
<p><img src="/2023/05/23/uni-shader4/10.png" alt></p>
<p>下面我们来实现这个Shader，使用和上面一样的Shader，然后修改几个地方。</p>
<p>首先将Properties修改如下，记得一并修改Pass中声明的变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Properties&#123;</span><br><span class="line">		_Color(&quot;Main Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">		_MainTex(&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_AlphaScale(&quot;Alpha Scale&quot;, Range(0,1)) = 1</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">		fixed4 _Color;</span><br><span class="line">		sampler2D _MainTex;</span><br><span class="line">		float4 _MainTex_ST;</span><br><span class="line">		fixed _AlphaScale;</span><br></pre></td></tr></table></figure>
<p>新增的变量AlphaScale用于控制整体的透明度。然后修改标签如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tags&#123;&quot;Queue&quot; = &quot;Transparent&quot; &quot;IgnoreProjector&quot; = &quot;True&quot; &quot;RenderType&quot; = &quot;Transparent&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>RenderType指明了Shader是一个透明度混合的Shader。我们还需要在Pass中关闭深度写入，设置混合因子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">			Tags &#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line">		</span><br><span class="line">		ZWrite Off</span><br><span class="line">		Blend SrcAlpha OneMinusSrcAlpha</span><br></pre></td></tr></table></figure>
<p>接下来修改片元着色器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">			fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">			fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">			fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">			fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">			fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">			fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">			return fixed4(ambient + diffuse, texColor.a * _AlphaScale);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>其实仅修改了返回值的Alpha，就得到下面的效果了：</p>
<p><img src="/2023/05/23/uni-shader4/5.png" alt></p>
<p>到这里我们不得不面对前面提到的一个问题：模型本身具有复杂遮挡关系时，如何保证每个部分的排序正确？由于我们关闭了深度写入，所以无法对模型进行像素级别的深度排序，不可避免地会出现一些排序错误的情况。这里我们可以使用开启深度写入的半透明效果解决这个问题。</p>
<h2 id="开启深度写入的半透明效果"><a href="#开启深度写入的半透明效果" class="headerlink" title="开启深度写入的半透明效果"></a>开启深度写入的半透明效果</h2><p>我们使用两个Pass来渲染一个模型，第一个Pass开启深度写入但是不写入颜色，这时我们的深度缓冲中已经存在了正确的深度信息；第二个Pass进行正常的透明混合，此时就可以使用和前面相同的操作了。只不过这种方法增加了性能开销。</p>
<p>我们只需要在前一个小节的Shader中加入以下的Pass：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">			ZWrite On</span><br><span class="line">			ColorMask 0</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>这个Pass开启了深度写入，然后使用ColorMask语义设置颜色通道的写掩码，可以是RGB/A/0/RGBA的任意组合，0表示Pass不写入任何颜色通道，不会修改颜色缓冲。</p>
<p>我们得到了这样的效果：</p>
<p><img src="/2023/05/23/uni-shader4/6.png" alt></p>
<p>如果使用前一节的Shader，得到的就是错误的渲染：</p>
<p><img src="/2023/05/23/uni-shader4/7.png" alt></p>
<h2 id="双面渲染的透明效果"><a href="#双面渲染的透明效果" class="headerlink" title="双面渲染的透明效果"></a>双面渲染的透明效果</h2><p>之前的渲染中，我们没有开启双面渲染，这导致半透明物体的内部结构完全是看不到的，看起来就像只有半个一样。因此我们可以使用Cull指令来控制需要剔除哪个面，它的语法是：</p>
<p>Cull Back | Front | Off</p>
<p>设置为Back时背对摄像机的图元不会被渲染，也是默认情况；Front时朝向摄像机的图元不会被渲染；Off时关闭剔除功能。</p>
<h3 id="透明度测试的双面渲染效果"><a href="#透明度测试的双面渲染效果" class="headerlink" title="透明度测试的双面渲染效果"></a>透明度测试的双面渲染效果</h3><p>只需要在前面透明度测试的代码中添加下面的Cull命令就能看到效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">	Tags &#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line"></span><br><span class="line">Cull Off</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/23/uni-shader4/11.png" alt></p>
<h3 id="透明度混合的双面渲染效果"><a href="#透明度混合的双面渲染效果" class="headerlink" title="透明度混合的双面渲染效果"></a>透明度混合的双面渲染效果</h3><p>我们使用两个Pass，第一个Pass负责渲染背面，第二个Pass负责渲染正面，Unity将按顺序执行Pass，所以背面将先被渲染，这保证了渲染顺序的正确。所以将之前Shader中的Pass复制一份，第一个Pass开启剔除正面，第二个Pass开启剔除背面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">			Tags &#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line">		</span><br><span class="line">		Cull Front</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pass&#123;</span><br><span class="line">			Tags &#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line">		</span><br><span class="line">		Cull Back</span><br></pre></td></tr></table></figure>
<p>得到下面的结果：</p>
<p><img src="/2023/05/23/uni-shader4/12.png" alt></p>
<h2 id="透明总结"><a href="#透明总结" class="headerlink" title="透明总结"></a>透明总结</h2><p>到这里入门系列就结束了，透明部分主要是使用了各项ShaderLab的设置，没有太多的代码，重点是实现透明效果的两种方法，以及混合的原理，通过开启面的剔除可以得到双面渲染的结果。这里还尝试了使用多个Pass处理问题，是比较消耗性能的做法。</p>
<p>后面部分是中级篇，讲了进阶光照，高级纹理和动态Shder的实现。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CG/" rel="tag"># CG</a>
              <a href="/tags/Unity/" rel="tag"># Unity</a>
              <a href="/tags/Shader/" rel="tag"># Shader</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/05/23/pbr-unishader/" rel="prev" title="Unity Shader实现Cook-Torrance模型的光照部分">
                  <i class="fa fa-angle-left"></i> Unity Shader实现Cook-Torrance模型的光照部分
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/03/uni-shader5/" rel="next" title="Unity和Shader进阶（五）">
                  Unity和Shader进阶（五） <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa-solid fa-paper-plane"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ANKIIMA</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
